/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

(function(a,k,h){a(function(){var b=a("#config"),d=Joomla.submitbutton;a(".nav-tabs").on("click","[data-toggle]",function(){h._tab=a(this).attr("href")});setTimeout(function(){h._tab&&a(".nav-tabs [href='"+h._tab+"']").trigger("click")},1);Joomla.submitbutton=function(a){"style.save"==a?f.save("save",a):"style.save2copy"==a?f.save("save-copy",a):"style.apply"==a?f.save("apply",a):d(a)};b.closest("#templatestyleOptions").before(b).remove()});var f={save:function(b,d){var e=a("#config"),c=a('form[name="adminForm"]'),
l=c.find("#jform_template").val(),j=a("#toolbar-"+b);j.addClass("saving");a.ajax({url:c.attr("action"),type:"post",data:{option:"com_templates",template:l,callback:"config",tmpl:"warp-ajax",config:a(":input",e).serialize()},success:function(b){j.removeClass("saving");try{if(b=a.parseJSON(b),"success"!=b.message){alert("Save failed!");return}}catch(c){}submitbutton(d)}})},saveFiles:function(b){var d=a.Deferred(),e=a('form[name="adminForm"]'),c=e.find("#jform_template").val();b={files:b};a.ajax({url:e.attr("action"),
type:"post",data:a.extend(b,{option:"com_templates",template:c,callback:"files",tmpl:"warp-ajax"})}).always(function(b,c,e){var g=!1;if("error"==c)g=e;else try{b=a.parseJSON(b),"success"!=b.message&&(g=b.message)}catch(f){g="Saving failed!"}d[g?"reject":"resolve"](g)});return d.promise()},data:function(){var b=a.Deferred(),d=a('form[name="adminForm"]'),e=d.find("#jform_template").val();a.ajax({url:d.attr("action"),type:"post",data:{option:"com_templates",template:e,callback:"styles",tmpl:"warp-ajax"}}).always(function(c,
d,e){var f=!1;if("error"==d)f=e;else try{if(c=a.parseJSON(c),"error"==c.message)f=c.message;else{b.resolve(c);return}}catch(g){f="Retrieving styles data failed!"}b.reject(f)});return b.promise()}};k.System=f})(jQuery,this,window.sessionStorage||{});
